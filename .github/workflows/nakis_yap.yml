name: Janome MB4 Modern Serif Uretim

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  embroidery_and_build:
    runs-on: ubuntu-latest
    steps:
      - name: Kodlari Cek
        uses: actions/checkout@v4

      - name: Python Hazirla
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Kutuphane Kur
        run: pip install pyembroidery

      - name: Modern Tasarim Kodunu Olustur
        run: |
          cat <<EOF > create_pivaz.py
          import pyembroidery
          import math

          def add_satin_path(pattern, points, width=35):
              """Noktalar arasını modern saten dikişle doldurur"""
              for i in range(len(points) - 1):
                  x1, y1 = points[i]
                  x2, y2 = points[i+1]
                  
                  angle = math.atan2(y2 - y1, x2 - x1)
                  perp_angle = angle + math.pi / 2
                  dx, dy = math.cos(perp_angle) * width, math.sin(perp_angle) * width
                  
                  distance = math.sqrt((x2-x1)**2 + (y2-y1)**2)
                  steps = int(distance // 8) # Daha sık dikiş (0.8mm)
                  if steps < 1: steps = 1
                  
                  for j in range(steps + 1):
                      ratio = j / steps
                      cx, cy = x1 + (x2-x1)*ratio, y1 + (y2-y1)*ratio
                      if j % 2 == 0:
                          pattern.add_stitch_absolute(pyembroidery.STITCH, int(cx + dx), int(cy + dy))
                      else:
                          pattern.add_stitch_absolute(pyembroidery.STITCH, int(cx - dx), int(cy - dy))

          def ciz():
              pattern = pyembroidery.EmbPattern()
              w = 32 # Modern, ince-orta hat kalınlığı

              # P - Modern Dar Kesim
              pattern.add_stitch_absolute(pyembroidery.JUMP, -450, 350)
              add_satin_path(pattern, [(-450, 350), (-450, -350)], w)
              add_satin_path(pattern, [(-450, -350), (-250, -350), (-250, -50), (-450, -50)], w)

              # I - Sans-Serif (Basit ve Net)
              pattern.add_stitch_absolute(pyembroidery.JUMP, -150, 350)
              add_satin_path(pattern, [(-150, 350), (-150, -350)], w)

              # V - Keskin Açılı Modern
              pattern.add_stitch_absolute(pyembroidery.JUMP, -50, -350)
              add_satin_path(pattern, [(-50, -350), (100, 350), (250, -350)], w)

              # A - Modern (Orta çizgi biraz aşağıda)
              pattern.add_stitch_absolute(pyembroidery.JUMP, 300, 350)
              add_satin_path(pattern, [(300, 350), (450, -350), (600, 350)], w)
              pattern.add_stitch_absolute(pyembroidery.JUMP, 370, 100)
              add_satin_path(pattern, [(370, 100), (530, 100)], w)

              # Z - Dinamik Eğimli
              pattern.add_stitch_absolute(pyembroidery.JUMP, 650, -350)
              add_satin_path(pattern, [(650, -350), (850, -350), (650, 350), (850, 350)], w)

              pattern.end()
              final = pattern.get_normalized_pattern()
              pyembroidery.write(final, "pivaz_modern.dst")
              pyembroidery.write(final, "pivaz_modern.jef")

          if __name__ == "__main__":
              ciz()
          EOF

      - name: Calistir ve Uret
        run: python create_pivaz.py

      - name: Dosyalari Yukle
        uses: actions/upload-artifact@v4
        with:
          name: PIVAZ_ROBOTO_STYLE
          path: |
            pivaz_modern.dst
            pivaz_modern.jef
